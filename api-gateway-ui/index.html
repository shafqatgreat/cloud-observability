<!DOCTYPE html>
<html>
<head>
  <title>API Gateway Auth Simulation1</title>

  <style>
    body {
      font-family: Arial;
      background: #0f172a;
      color: #e5e7eb;
      padding: 40px;
    }

    h2 { color: #38bdf8; }

    input, button {
      padding: 10px;
      margin: 6px 0;
      width: 320px;
    }

    button {
      background: #38bdf8;
      border: none;
      cursor: pointer;
      font-weight: bold;
    }

    pre {
      background: #020617;
      padding: 15px;
      margin-top: 10px;
      border-radius: 6px;
      overflow-x: auto;
    }

    .box {
      border: 1px solid #334155;
      padding: 20px;
      margin-bottom: 30px;
      border-radius: 8px;
    }
  </style>
</head>

<body>

<h1>üîê API Gateway Authorization Flow Simulator</h1>

<!-- LOGIN -->
<div class="box">
  <h2>1Ô∏è‚É£ Login (via API Gateway)</h2>

  <input id="email" placeholder="email" value="test@test.com" /><br />
  <input id="password" type="password" placeholder="password" value="123456" /><br />

  <button onclick="login()">Login</button>

  <pre id="loginResult"></pre>
</div>

<!-- TOKEN -->
<div class="box">
  <h2>2Ô∏è‚É£ Stored Identity Token</h2>
  <button onclick="showToken()">Show Token</button>
  <pre id="tokenBox"></pre>
</div>

<!-- ORDER SERVICE -->
<div class="box">
  <h2>3Ô∏è‚É£ Access Protected Order Service</h2>
  <button onclick="getOrders()">Get Orders</button>
  <pre id="orderResult"></pre>
</div>

<script>
  // ‚úÖ ONLY API GATEWAY ‚Äî NEVER INTERNAL SERVICES
  // const API_GATEWAY = "https://api-gateway.shafqatgreat.workers.dev";
  const API_GATEWAY = "https://api-gateway-cm.up.railway.app";

  async function login() {
    const email = document.getElementById("email").value;
    const password = document.getElementById("password").value;

    const res = await fetch(`${API_GATEWAY}/login`, {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify({ email, password })
    });

    const data = await res.json();

    if (data.token) {
      localStorage.setItem("token", data.token);
    }

    document.getElementById("loginResult").textContent =
      JSON.stringify(data, null, 2);
  }

  function showToken() {
    const token = localStorage.getItem("token");
    document.getElementById("tokenBox").textContent =
      token || "‚ùå No token stored";
  }

  async function getOrders() {
    const token = localStorage.getItem("token");

    const res = await fetch(`${API_GATEWAY}/orders`, {
      headers: {
        Authorization: "Bearer " + token
      }
    });

    const data = await res.json();

    document.getElementById("orderResult").textContent =
      JSON.stringify(data, null, 2);
  }
</script>

</body>
</html>
